<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Back/Forward Cache ç¼“å­˜ç¤ºä¾‹</title>
    
    <style>
        /* View Transitions API æ ·å¼ */
        @view-transition {
            navigation: auto;
        }
        
        ::view-transition-old(root),
        ::view-transition-new(root) {
            animation: fadeSlide 0.4s ease both;
        }
        
        @keyframes fadeSlide {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* é¡µé¢åŸºç¡€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: #2c3e50;
            text-decoration: none;
            padding: 12px 24px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 25px;
            transition: all 0.3s ease;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }
        
        .nav-links a:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .cache-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .demo-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .demo-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }
        
        .demo-card:hover::before {
            animation: shine 0.6s ease-in-out;
        }
        
        .demo-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
        }
        
        @keyframes shine {
            0% { opacity: 0; transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .state-display {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid #2ecc71;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        .timer {
            font-size: 1.2em;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .code-snippet {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre;
        }
        
        .bfcache-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’¾ Back/Forward Cache æ¼”ç¤º</h1>
        
        <nav class="nav-links">
            <a href="mpa-basic.html">è¿”å›é¦–é¡µ</a>
            <a href="mpa-page2.html">é¡µé¢2</a>
            <a href="mpa-preload.html">é¢„åŠ è½½ç¤ºä¾‹</a>
            <a href="spa-comparison.html">SPAå¯¹æ¯”</a>
        </nav>
        
        <div class="demo-section">
            <h2>ğŸš€ æµè§ˆå™¨æ™ºèƒ½ç¼“å­˜</h2>
            <p>Back/Forward Cache (BFCache) æ˜¯ç°ä»£æµè§ˆå™¨çš„ä¸€é¡¹å¼ºå¤§åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†æ•´ä¸ªé¡µé¢ï¼ˆåŒ…æ‹¬JavaScriptçŠ¶æ€ï¼‰ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨çš„å‰è¿›/åé€€æŒ‰é’®æ—¶ï¼Œé¡µé¢å¯ä»¥ç¬é—´æ¢å¤ã€‚</p>
            
            <div class="state-display">
                <strong>é¡µé¢çŠ¶æ€ç›‘æ§:</strong><br>
                é¡µé¢åŠ è½½æ—¶é—´: <span id="loadTime">è®¡ç®—ä¸­...</span><br>
                å½“å‰æ—¶é—´: <span id="currentTime">--:--:--</span><br>
                é¡µé¢è®¿é—®æ¬¡æ•°: <span id="visitCount">1</span><br>
                BFCacheçŠ¶æ€: <span id="bfcacheStatus">æ£€æµ‹ä¸­...</span>
            </div>
            
            <div class="timer" id="timer">
                é¡µé¢æ´»è·ƒæ—¶é—´: 00:00:00
            </div>
        </div>
        
        <div class="cache-demo">
            <div class="demo-card" onclick="testBFCache('mpa-basic.html')">
                <h3>ğŸ  æµ‹è¯•BFCache - é¦–é¡µ</h3>
                <p>ç‚¹å‡»è®¿é—®é¦–é¡µï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨åé€€æŒ‰é’®è¿”å›</p>
                <small>è§‚å¯Ÿé¡µé¢çŠ¶æ€æ˜¯å¦ä¿æŒ</small>
            </div>
            
            <div class="demo-card" onclick="testBFCache('mpa-preload.html')">
                <h3>âš¡ æµ‹è¯•BFCache - é¢„åŠ è½½</h3>
                <p>è®¿é—®é¢„åŠ è½½é¡µé¢ï¼Œä½“éªŒç¬é—´æ¢å¤</p>
                <small>JavaScriptçŠ¶æ€å®Œå…¨ä¿æŒ</small>
            </div>
            
            <div class="demo-card" onclick="simulateHeavyTask()">
                <h3>ğŸ”„ æ¨¡æ‹Ÿé‡ä»»åŠ¡</h3>
                <p>å¯åŠ¨è®¡æ—¶å™¨å’ŒåŠ¨ç”»ï¼Œæµ‹è¯•çŠ¶æ€ä¿æŒ</p>
                <small>BFCacheä¼šä¿æŒæ‰€æœ‰è¿è¡ŒçŠ¶æ€</small>
            </div>
        </div>
        
        <div class="performance-metrics">
            <div class="metric-card">
                <div class="metric-value" id="memoryUsage">--MB</div>
                <div>å†…å­˜ä½¿ç”¨</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="cacheHitRate">--%</div>
                <div>ç¼“å­˜å‘½ä¸­ç‡</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="restoreTime">--ms</div>
                <div>æ¢å¤æ—¶é—´</div>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ”§ BFCache ä¼˜åŒ–æŠ€å·§</h3>
            <ul style="text-align: left; max-width: 700px; margin: 0 auto;">
                <li><strong>é¿å… unload äº‹ä»¶:</strong> ä½¿ç”¨ pagehide å’Œ pageshow äº‹ä»¶</li>
                <li><strong>æ¸…ç†å®šæ—¶å™¨:</strong> åœ¨é¡µé¢éšè—æ—¶æš‚åœï¼Œæ˜¾ç¤ºæ—¶æ¢å¤</li>
                <li><strong>é¿å…æŒä¹…è¿æ¥:</strong> WebSocketã€EventSourceç­‰ä¼šé˜»æ­¢ç¼“å­˜</li>
                <li><strong>åˆç†ä½¿ç”¨Cache-Control:</strong> ä¸è¦è®¾ç½® no-store</li>
            </ul>
            
            <div class="code-snippet">// BFCache å‹å¥½çš„äº‹ä»¶å¤„ç†
window.addEventListener('pageshow', (event) => {
  if (event.persisted) {
    console.log('é¡µé¢ä»BFCacheæ¢å¤');
    // æ¢å¤å®šæ—¶å™¨ã€åŠ¨ç”»ç­‰
  }
});

window.addEventListener('pagehide', (event) => {
  if (event.persisted) {
    console.log('é¡µé¢è¿›å…¥BFCache');
    // æš‚åœå®šæ—¶å™¨ã€æ¸…ç†èµ„æº
  }
});</div>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ“Š æ€§èƒ½å¯¹æ¯”</h3>
            <p>ä½¿ç”¨BFCacheçš„é¡µé¢æ¢å¤é€Ÿåº¦æ¯”é‡æ–°åŠ è½½å¿« <strong>10-50å€</strong>ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡ã€‚</p>
            <div style="display: flex; justify-content: space-around; margin: 20px 0;">
                <div style="text-align: center;">
                    <div style="font-size: 2em; color: #e74c3c;">~500ms</div>
                    <div>ä¼ ç»Ÿé¡µé¢åŠ è½½</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2em; color: #27ae60;">~10ms</div>
                    <div>BFCacheæ¢å¤</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="bfcache-status" id="bfcacheStatusBar">
        æ£€æµ‹BFCacheæ”¯æŒæƒ…å†µ...
    </div>
    
    <script>
        let startTime = performance.now();
        let visitCount = parseInt(sessionStorage.getItem('visitCount') || '0') + 1;
        let timerInterval;
        let pageStartTime = Date.now();
        
        // æ›´æ–°è®¿é—®è®¡æ•°
        sessionStorage.setItem('visitCount', visitCount.toString());
        
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            
            const elapsed = Math.floor((Date.now() - pageStartTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('timer').textContent = 
                `é¡µé¢æ´»è·ƒæ—¶é—´: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function testBFCache(url) {
            console.log(`ğŸ” æµ‹è¯•BFCache: å¯¼èˆªåˆ° ${url}`);
            window.location.href = url;
        }
        
        function simulateHeavyTask() {
            console.log('ğŸ”„ å¯åŠ¨é‡ä»»åŠ¡æ¨¡æ‹Ÿ');
            // æ¨¡æ‹Ÿä¸€äº›æŒç»­çš„ä»»åŠ¡
            let counter = 0;
            const heavyInterval = setInterval(() => {
                counter++;
                console.log(`é‡ä»»åŠ¡æ‰§è¡Œä¸­: ${counter}`);
            }, 1000);
            
            // 5ç§’ååœæ­¢
            setTimeout(() => {
                clearInterval(heavyInterval);
                console.log('é‡ä»»åŠ¡å®Œæˆ');
            }, 5000);
        }
        
        function updateMetrics() {
            // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
            if ('memory' in performance) {
                const memoryInfo = performance.memory;
                const usedMB = Math.round(memoryInfo.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memoryUsage').textContent = `${usedMB}MB`;
            }
            
            // æ¨¡æ‹Ÿç¼“å­˜å‘½ä¸­ç‡
            const hitRate = Math.floor(Math.random() * 20) + 80;
            document.getElementById('cacheHitRate').textContent = `${hitRate}%`;
            
            // æ¨¡æ‹Ÿæ¢å¤æ—¶é—´
            const restoreTime = Math.floor(Math.random() * 20) + 5;
            document.getElementById('restoreTime').textContent = `${restoreTime}ms`;
        }
        
        // é¡µé¢æ˜¾ç¤ºäº‹ä»¶ - BFCacheå…³é”®äº‹ä»¶
        window.addEventListener('pageshow', (event) => {
            const statusBar = document.getElementById('bfcacheStatusBar');
            
            if (event.persisted) {
                console.log('âœ… é¡µé¢ä»BFCacheæ¢å¤!');
                statusBar.textContent = 'âœ… ä»BFCacheæ¢å¤ - ç¬é—´åŠ è½½!';
                statusBar.style.background = 'rgba(0, 128, 0, 0.9)';
                
                // æ¢å¤å®šæ—¶å™¨
                pageStartTime = Date.now() - (visitCount * 10000); // æ¨¡æ‹Ÿä¹‹å‰çš„æ—¶é—´
            } else {
                console.log('ğŸ”„ é¡µé¢æ­£å¸¸åŠ è½½');
                statusBar.textContent = 'ğŸ”„ æ­£å¸¸åŠ è½½ - é¦–æ¬¡è®¿é—®';
                statusBar.style.background = 'rgba(52, 152, 219, 0.9)';
            }
            
            // 3ç§’åæ·¡åŒ–çŠ¶æ€æ 
            setTimeout(() => {
                statusBar.style.opacity = '0.7';
            }, 3000);
        });
        
        // é¡µé¢éšè—äº‹ä»¶ - BFCacheå…³é”®äº‹ä»¶
        window.addEventListener('pagehide', (event) => {
            if (event.persisted) {
                console.log('ğŸ’¾ é¡µé¢è¿›å…¥BFCache');
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥æš‚åœå®šæ—¶å™¨ã€æ¸…ç†èµ„æº
            } else {
                console.log('ğŸ—‘ï¸ é¡µé¢è¢«å¸è½½');
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            const loadTime = performance.now();
            document.getElementById('loadTime').textContent = `${loadTime.toFixed(2)}ms`;
            document.getElementById('visitCount').textContent = visitCount;
            
            console.log(`ğŸ“Š ç¼“å­˜é¡µé¢åŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms`);
            console.log(`ğŸ”¢ é¡µé¢è®¿é—®æ¬¡æ•°: ${visitCount}`);
            
            // å¯åŠ¨å®šæ—¶å™¨
            timerInterval = setInterval(updateTime, 1000);
            updateTime();
            
            // å®šæœŸæ›´æ–°æŒ‡æ ‡
            setInterval(updateMetrics, 2000);
            updateMetrics();
            
            // æ£€æŸ¥BFCacheæ”¯æŒ
            const bfcacheSupported = 'onpagehide' in window && 'onpageshow' in window;
            document.getElementById('bfcacheStatus').textContent = 
                bfcacheSupported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ';
        });
        
        // é¡µé¢å¸è½½å‰æ¸…ç†
        window.addEventListener('beforeunload', () => {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });
    </script>
</body>
</html>