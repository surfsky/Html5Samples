<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ª£Á†ÅÊü•ÁúãÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }
        
        .code-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100%;
            overflow: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
        }
        
        .code-header {
            background: #2d2d30;
            color: #cccccc;
            padding: 8px 16px;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .code-content {
            padding: 16px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            flex: 1;
            overflow: auto;
            background: #1e1e1e;
        }
        
        .loading {
            color: #888;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        .error {
            color: #f44336;
            padding: 16px;
            background: #2d1b1b;
            border-left: 4px solid #f44336;
            margin: 16px;
            border-radius: 4px;
        }
        
        .code-icon {
            font-size: 16px;
        }
        
        /* ÊªöÂä®Êù°Ê†∑Âºè */
        .code-content::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .code-content::-webkit-scrollbar-track {
            background: #2d2d30;
        }
        
        .code-content::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        
        .code-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* ‰ª£Á†ÅÈ´ò‰∫ÆÊ†∑Âºè */
        .code-content {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
        }
        
        /* Ë°åÂè∑Ê†∑Âºè */
        .line-numbers {
            display: flex;
        }
        
        .line-numbers-column {
            background: #252526;
            color: #858585;
            padding: 16px 8px;
            text-align: right;
            user-select: none;
            border-right: 1px solid #3e3e42;
            min-width: 50px;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .code-lines {
            flex: 1;
            padding: 16px;
        }
        
        .show-line-numbers .code-content {
            padding: 0;
            display: flex;
        }
        
        /* Â∑•ÂÖ∑Ê†èÊ†∑Âºè */
        .toolbar {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .toolbar button {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #cccccc;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .toolbar button:hover {
            background: #4c4c4c;
        }
        
        .toolbar button.active {
            background: #007acc;
            border-color: #007acc;
        }
    </style>
</head>
<body>
    <div class="code-viewer">
        <div class="code-header">
            <span class="code-icon">üíª</span>
            <span id="codeFileName">‰ª£Á†ÅÊü•ÁúãÂô®</span>
        </div>
        
        <div class="toolbar">
            <button id="toggleLineNumbers" title="ÂàáÊç¢Ë°åÂè∑ÊòæÁ§∫">Ë°åÂè∑</button>
            <button id="copyCode" title="Â§çÂà∂‰ª£Á†Å">Â§çÂà∂</button>
            <button id="downloadCode" title="‰∏ãËΩΩ‰ª£Á†Å">‰∏ãËΩΩ</button>
            <span style="margin-left: auto; color: #888;" id="fileInfo"></span>
        </div>
        
        <div class="code-content" id="codeContent">
            <div class="loading">Ê≠£Âú®Âä†ËΩΩ‰ª£Á†Å...</div>
        </div>
    </div>
    
    <script>
        class CodeViewer {
            constructor() {
                this.codeContent = document.getElementById('codeContent');
                this.codeFileName = document.getElementById('codeFileName');
                this.fileInfo = document.getElementById('fileInfo');
                this.showLineNumbers = false;
                this.currentCode = '';
                this.currentFilePath = '';
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.loadCodeFromUrl();
            }
            
            bindEvents() {
                // ÂàáÊç¢Ë°åÂè∑ÊòæÁ§∫
                document.getElementById('toggleLineNumbers').addEventListener('click', () => {
                    this.toggleLineNumbers();
                });
                
                // Â§çÂà∂‰ª£Á†Å
                document.getElementById('copyCode').addEventListener('click', () => {
                    this.copyCode();
                });
                
                // ‰∏ãËΩΩ‰ª£Á†Å
                document.getElementById('downloadCode').addEventListener('click', () => {
                    this.downloadCode();
                });
            }
            
            /**
             * ‰ªéURLÂèÇÊï∞Âä†ËΩΩ‰ª£Á†Å
             */
            loadCodeFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const filePath = urlParams.get('file');
                
                if (filePath) {
                    this.loadSourceCode(filePath);
                } else {
                    this.showMessage('ËØ∑ÈÄöËøáURLÂèÇÊï∞ÊåáÂÆöË¶ÅÊü•ÁúãÁöÑÊñá‰ª∂Ôºå‰æãÂ¶Ç: code.html?file=about.html');
                }
            }
            
            /**
             * Âä†ËΩΩÊ∫ê‰ª£Á†Å
             */
            async loadSourceCode(filePath) {
                try {
                    this.currentFilePath = filePath;
                    this.codeContent.innerHTML = '<div class="loading">Âä†ËΩΩÊ∫ê‰ª£Á†Å‰∏≠...</div>';
                    this.updateFileName(filePath);
                    
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const sourceCode = await response.text();
                    this.currentCode = sourceCode;
                    this.displaySourceCode(sourceCode);
                    this.updateFileInfo(sourceCode, filePath);
                    
                } catch (error) {
                    console.error('Âä†ËΩΩÊ∫ê‰ª£Á†ÅÂ§±Ë¥•:', error);
                    this.showError(`Âä†ËΩΩÊ∫ê‰ª£Á†ÅÂ§±Ë¥•: ${error.message}`);
                }
            }
            
            /**
             * ÊòæÁ§∫Ê∫ê‰ª£Á†Å
             */
            displaySourceCode(code) {
                // ÁÆÄÂçïÁöÑHTMLËΩ¨‰πâ
                const escapedCode = code
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;');
                
                if (this.showLineNumbers) {
                    this.displayWithLineNumbers(escapedCode);
                } else {
                    this.codeContent.innerHTML = escapedCode;
                }
            }
            
            /**
             * ÊòæÁ§∫Â∏¶Ë°åÂè∑ÁöÑ‰ª£Á†Å
             */
            displayWithLineNumbers(code) {
                const lines = code.split('\n');
                const lineNumbers = lines.map((_, index) => index + 1).join('\n');
                
                this.codeContent.innerHTML = `
                    <div class="line-numbers-column">${lineNumbers}</div>
                    <div class="code-lines">${code}</div>
                `;
                
                this.codeContent.classList.add('show-line-numbers');
            }
            
            /**
             * ÂàáÊç¢Ë°åÂè∑ÊòæÁ§∫
             */
            toggleLineNumbers() {
                this.showLineNumbers = !this.showLineNumbers;
                const button = document.getElementById('toggleLineNumbers');
                
                if (this.showLineNumbers) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                    this.codeContent.classList.remove('show-line-numbers');
                }
                
                if (this.currentCode) {
                    this.displaySourceCode(this.currentCode);
                }
            }
            
            /**
             * Â§çÂà∂‰ª£Á†Å
             */
            async copyCode() {
                if (!this.currentCode) {
                    this.showMessage('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑ‰ª£Á†Å');
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(this.currentCode);
                    this.showMessage('‰ª£Á†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                } catch (error) {
                    console.error('Â§çÂà∂Â§±Ë¥•:', error);
                    this.showMessage('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÊã©Â§çÂà∂', 'error');
                }
            }
            
            /**
             * ‰∏ãËΩΩ‰ª£Á†Å
             */
            downloadCode() {
                if (!this.currentCode) {
                    this.showMessage('Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑ‰ª£Á†Å');
                    return;
                }
                
                const fileName = this.getFileName(this.currentFilePath) || 'code.txt';
                const blob = new Blob([this.currentCode], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showMessage('‰ª£Á†ÅÂ∑≤‰∏ãËΩΩ', 'success');
            }
            
            /**
             * Êõ¥Êñ∞Êñá‰ª∂ÂêçÊòæÁ§∫
             */
            updateFileName(filePath) {
                const fileName = this.getFileName(filePath);
                this.codeFileName.textContent = fileName || 'Êú™Áü•Êñá‰ª∂';
            }
            
            /**
             * Êõ¥Êñ∞Êñá‰ª∂‰ø°ÊÅØ
             */
            updateFileInfo(code, filePath) {
                const lines = code.split('\n').length;
                const chars = code.length;
                const size = new Blob([code]).size;
                
                let sizeText = size + ' bytes';
                if (size > 1024) {
                    sizeText = (size / 1024).toFixed(1) + ' KB';
                }
                
                this.fileInfo.textContent = `${lines} Ë°å, ${chars} Â≠óÁ¨¶, ${sizeText}`;
            }
            
            /**
             * Ëé∑ÂèñÊñá‰ª∂Âêç
             */
            getFileName(filePath) {
                if (!filePath) return '';
                return filePath.split('/').pop() || filePath;
            }
            
            /**
             * ÊòæÁ§∫Ê∂àÊÅØ
             */
            showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'error' ? 'error' : 'loading';
                messageDiv.textContent = message;
                
                this.codeContent.innerHTML = '';
                this.codeContent.appendChild(messageDiv);
                
                // Â¶ÇÊûúÊòØÊàêÂäüÊàñ‰ø°ÊÅØÊ∂àÊÅØÔºå3ÁßíÂêéËá™Âä®Ê∂àÂ§±
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        if (this.currentCode) {
                            this.displaySourceCode(this.currentCode);
                        }
                    }, 2000);
                }
            }
            
            /**
             * ÊòæÁ§∫ÈîôËØØ
             */
            showError(message) {
                this.showMessage(message, 'error');
            }
        }
        
        // ÂàùÂßãÂåñ‰ª£Á†ÅÊü•ÁúãÂô®
        document.addEventListener('DOMContentLoaded', () => {
            new CodeViewer();
        });
        
        // ÁõëÂê¨Êù•Ëá™Áà∂Á™óÂè£ÁöÑÊ∂àÊÅØ
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'loadCode' && event.data.filePath) {
                const viewer = new CodeViewer();
                viewer.loadSourceCode(event.data.filePath);
            }
        });
    </script>
</body>
</html>