<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç æŸ¥çœ‹å™¨</title>
    <!-- Prism.js ä»£ç é«˜äº®åº“ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }
        
        .code-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100%;
            overflow: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
        }
        
        .code-header {
            background: #2d2d30;
            color: #cccccc;
            padding: 8px 16px;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .code-content {
            padding: 16px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            flex: 1;
            overflow: auto;
            background: #1e1e1e;
        }
        
        .loading {
            color: #888;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        .error {
            color: #f44336;
            padding: 16px;
            background: #2d1b1b;
            border-left: 4px solid #f44336;
            margin: 16px;
            border-radius: 4px;
        }
        
        .code-icon {
            font-size: 16px;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .code-content::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .code-content::-webkit-scrollbar-track {
            background: #2d2d30;
        }
        
        .code-content::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        
        .code-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* ä»£ç é«˜äº®æ ·å¼ */
        .code-content {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
        }
        
        /* Prism.js æ ·å¼è¦†ç›– */
        pre[class*="language-"] {
            background: #1e1e1e !important;
            color: #d4d4d4 !important;
            margin: 0;
            padding: 16px;
            overflow: visible;
            border-radius: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .show-line-numbers pre[class*="language-"] {
            padding: 0;
        }
        
        code[class*="language-"] {
            background: transparent !important;
            color: inherit;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
        }
        
        /* è¡Œå·æ ·å¼ä¼˜åŒ– */
        .line-numbers .line-numbers-rows {
            border-right: 1px solid #3e3e42;
            background: #252526;
            color: #858585;
            padding-left: 8px;
            padding-right: 8px;
        }
        
        .line-numbers .line-numbers-rows > span:before {
            color: #858585;
            text-align: right;
            padding-right: 8px;
        }
        
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #6a9955 !important;
        }
        
        .token.punctuation {
            color: #d4d4d4 !important;
        }
        
        .token.property,
        .token.tag,
        .token.boolean,
        .token.number,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #b5cea8 !important;
        }
        
        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #ce9178 !important;
        }
        
        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string {
            color: #d4d4d4 !important;
        }
        
        .token.atrule,
        .token.attr-value,
        .token.keyword {
            color: #569cd6 !important;
        }
        
        .token.function,
        .token.class-name {
            color: #dcdcaa !important;
        }
        
        .token.regex,
        .token.important,
        .token.variable {
            color: #d16969 !important;
        }
        
        /* Prism.jsè¡Œå·æ’ä»¶æ ·å¼è¦†ç›– */
        .line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber;
        }
        
        .line-numbers > code {
            position: relative;
            white-space: inherit;
        }
        
        .line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 0;
            font-size: 100%;
            left: -3.8em;
            width: 3em;
            letter-spacing: -1px;
            border-right: 1px solid #3e3e42;
            user-select: none;
            counter-reset: linenumber;
        }
        
        .line-numbers-rows > span {
            pointer-events: none;
            display: block;
            counter-increment: linenumber;
        }
        
        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #858585;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }
        
        /* å·¥å…·æ æ ·å¼ */
        .toolbar {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .toolbar button {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #cccccc;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .toolbar button:hover {
            background: #4c4c4c;
        }
        
        .toolbar button.active {
            background: #007acc;
            border-color: #007acc;
        }
    </style>
</head>
<body>
    <div class="code-viewer">
        <div class="code-header">
            <span class="code-icon">ğŸ’»</span>
            <span id="codeFileName">ä»£ç æŸ¥çœ‹å™¨</span>
        </div>
        
        <div class="toolbar">
            <button id="copyCode" title="å¤åˆ¶ä»£ç ">å¤åˆ¶</button>
            <button id="downloadCode" title="ä¸‹è½½ä»£ç ">ä¸‹è½½</button>
            <span style="margin-left: auto; color: #888;" id="fileInfo"></span>
        </div>
        
        <div class="code-content" id="codeContent">
            <div class="loading">æ­£åœ¨åŠ è½½ä»£ç ...</div>
        </div>
    </div>
    
    <script>
        class CodeViewer {
            constructor() {
                this.codeContent = document.getElementById('codeContent');
                this.codeFileName = document.getElementById('codeFileName');
                this.fileInfo = document.getElementById('fileInfo');
                this.showLineNumbers = true;
                this.currentCode = '';
                this.currentFilePath = '';
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.loadCodeFromUrl();
            }
            
            bindEvents() {
                // å¤åˆ¶ä»£ç 
                document.getElementById('copyCode').addEventListener('click', () => {
                    this.copyCode();
                });
                
                // ä¸‹è½½ä»£ç 
                document.getElementById('downloadCode').addEventListener('click', () => {
                    this.downloadCode();
                });
            }
            
            /**
             * ä»URLå‚æ•°åŠ è½½ä»£ç 
             */
            loadCodeFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const filePath = urlParams.get('file');
                
                if (filePath) {
                    this.loadSourceCode(filePath);
                } else {
                    this.showMessage('è¯·é€šè¿‡URLå‚æ•°æŒ‡å®šè¦æŸ¥çœ‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚: code.html?file=about.html');
                }
            }
            
            /**
             * åŠ è½½æºä»£ç 
             */
            async loadSourceCode(filePath) {
                try {
                    this.currentFilePath = filePath;
                    this.codeContent.innerHTML = '<div class="loading">åŠ è½½æºä»£ç ä¸­...</div>';
                    this.updateFileName(filePath);
                    
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const sourceCode = await response.text();
                    this.currentCode = sourceCode;
                    this.displaySourceCode(sourceCode);
                    this.updateFileInfo(sourceCode, filePath);
                    
                } catch (error) {
                    console.error('åŠ è½½æºä»£ç å¤±è´¥:', error);
                    this.showError(`åŠ è½½æºä»£ç å¤±è´¥: ${error.message}`);
                }
            }
            
            /**
             * æ˜¾ç¤ºæºä»£ç 
             */
            displaySourceCode(code) {
                const language = this.detectLanguage(this.currentFilePath);
                
                if (this.showLineNumbers) {
                    this.displayWithLineNumbers(code, language);
                } else {
                    this.displayWithHighlight(code, language);
                }
            }
            
            /**
             * æ˜¾ç¤ºå¸¦è¯­æ³•é«˜äº®çš„ä»£ç 
             */
            displayWithHighlight(code, language) {
                const pre = document.createElement('pre');
                const codeElement = document.createElement('code');
                
                if (language) {
                    pre.className = `language-${language}`;
                    codeElement.className = `language-${language}`;
                }
                
                codeElement.textContent = code;
                pre.appendChild(codeElement);
                
                this.codeContent.innerHTML = '';
                this.codeContent.appendChild(pre);
                
                // åº”ç”¨è¯­æ³•é«˜äº®
                if (window.Prism) {
                    Prism.highlightElement(codeElement);
                }
            }
            
            /**
         * æ˜¾ç¤ºå¸¦è¡Œå·çš„ä»£ç 
         */
        displayWithLineNumbers(code, language) {
            const pre = document.createElement('pre');
            const codeElement = document.createElement('code');
            
            // ä½¿ç”¨Prism.jså®˜æ–¹è¡Œå·æ’ä»¶
            pre.className = 'line-numbers';
            if (language) {
                pre.className += ` language-${language}`;
                codeElement.className = `language-${language}`;
            }
            
            codeElement.textContent = code;
            pre.appendChild(codeElement);
            
            // æ¸…ç©ºå†…å®¹å¹¶æ·»åŠ preå…ƒç´ 
            this.codeContent.innerHTML = '';
            this.codeContent.appendChild(pre);
            
            // ç§»é™¤è‡ªå®šä¹‰è¡Œå·æ ·å¼ç±»
            this.codeContent.classList.remove('show-line-numbers');
            
            // åº”ç”¨è¯­æ³•é«˜äº®
            if (window.Prism) {
                Prism.highlightElement(codeElement);
            }
        }
            
            /**
             * æ ¹æ®æ–‡ä»¶æ‰©å±•åæ£€æµ‹ç¼–ç¨‹è¯­è¨€
             */
            detectLanguage(filePath) {
                if (!filePath) return null;
                
                const extension = filePath.split('.').pop().toLowerCase();
                const languageMap = {
                    'js': 'javascript',
                    'jsx': 'jsx',
                    'ts': 'typescript',
                    'tsx': 'tsx',
                    'html': 'html',
                    'htm': 'html',
                    'css': 'css',
                    'scss': 'scss',
                    'sass': 'sass',
                    'less': 'less',
                    'json': 'json',
                    'xml': 'xml',
                    'py': 'python',
                    'java': 'java',
                    'c': 'c',
                    'cpp': 'cpp',
                    'cc': 'cpp',
                    'cxx': 'cpp',
                    'cs': 'csharp',
                    'php': 'php',
                    'rb': 'ruby',
                    'go': 'go',
                    'rs': 'rust',
                    'swift': 'swift',
                    'kt': 'kotlin',
                    'scala': 'scala',
                    'sh': 'bash',
                    'bash': 'bash',
                    'zsh': 'bash',
                    'fish': 'bash',
                    'ps1': 'powershell',
                    'sql': 'sql',
                    'md': 'markdown',
                    'markdown': 'markdown',
                    'yml': 'yaml',
                    'yaml': 'yaml',
                    'toml': 'toml',
                    'ini': 'ini',
                    'conf': 'ini',
                    'dockerfile': 'docker',
                    'vue': 'vue',
                    'svelte': 'svelte',
                    'r': 'r',
                    'matlab': 'matlab',
                    'm': 'matlab'
                };
                
                return languageMap[extension] || null;
            }
            

            
            /**
             * å¤åˆ¶ä»£ç 
             */
            async copyCode() {
                if (!this.currentCode) {
                    this.showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„ä»£ç ');
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(this.currentCode);
                    this.showMessage('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } catch (error) {
                    console.error('å¤åˆ¶å¤±è´¥:', error);
                    this.showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
                }
            }
            
            /**
             * ä¸‹è½½ä»£ç 
             */
            downloadCode() {
                if (!this.currentCode) {
                    this.showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„ä»£ç ');
                    return;
                }
                
                const fileName = this.getFileName(this.currentFilePath) || 'code.txt';
                const blob = new Blob([this.currentCode], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showMessage('ä»£ç å·²ä¸‹è½½', 'success');
            }
            
            /**
             * æ›´æ–°æ–‡ä»¶åæ˜¾ç¤º
             */
            updateFileName(filePath) {
                const fileName = this.getFileName(filePath);
                this.codeFileName.textContent = fileName || 'æœªçŸ¥æ–‡ä»¶';
            }
            
            /**
             * æ›´æ–°æ–‡ä»¶ä¿¡æ¯
             */
            updateFileInfo(code, filePath) {
                const lines = code.split('\n').length;
                const chars = code.length;
                const size = new Blob([code]).size;
                
                let sizeText = size + ' bytes';
                if (size > 1024) {
                    sizeText = (size / 1024).toFixed(1) + ' KB';
                }
                
                this.fileInfo.textContent = `${lines} è¡Œ, ${chars} å­—ç¬¦, ${sizeText}`;
            }
            
            /**
             * è·å–æ–‡ä»¶å
             */
            getFileName(filePath) {
                if (!filePath) return '';
                return filePath.split('/').pop() || filePath;
            }
            
            /**
             * æ˜¾ç¤ºæ¶ˆæ¯
             */
            showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'error' ? 'error' : 'loading';
                messageDiv.textContent = message;
                
                this.codeContent.innerHTML = '';
                this.codeContent.appendChild(messageDiv);
                
                // å¦‚æœæ˜¯æˆåŠŸæˆ–ä¿¡æ¯æ¶ˆæ¯ï¼Œ3ç§’åè‡ªåŠ¨æ¶ˆå¤±
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        if (this.currentCode) {
                            this.displaySourceCode(this.currentCode);
                        }
                    }, 2000);
                }
            }
            
            /**
             * æ˜¾ç¤ºé”™è¯¯
             */
            showError(message) {
                this.showMessage(message, 'error');
            }
        }
        
        // åˆå§‹åŒ–ä»£ç æŸ¥çœ‹å™¨
        document.addEventListener('DOMContentLoaded', () => {
            new CodeViewer();
        });
        
        // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'loadCode' && event.data.filePath) {
                const viewer = new CodeViewer();
                viewer.loadSourceCode(event.data.filePath);
            }
        });
    </script>
    
    <!-- Prism.js æ ¸å¿ƒåº“å’Œè¯­è¨€æ”¯æŒ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
</body>
</html>